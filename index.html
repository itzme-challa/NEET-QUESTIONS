<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NEET Quiz Application</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        .hidden {
            display: none;
        }
        .quiz-container {
            max-width: 800px;
            margin: 0 auto;
        }
        .option-btn {
            transition: background-color 0.3s;
        }
        .option-btn:hover {
            background-color: #e5e7eb;
        }
        .correct {
            background-color: #d1fae5;
        }
        .incorrect {
            background-color: #fee2e2;
        }
    </style>
</head>
<body class="bg-gray-100">
    <div class="quiz-container p-6">
        <h1 class="text-3xl font-bold text-center mb-6">NEET Quiz Application</h1>

        <!-- Subject Selection -->
        <div id="subject-section" class="mb-6">
            <h2 class="text-2xl font-semibold mb-4">Select Subject</h2>
            <div id="subject-list" class="grid grid-cols-1 sm:grid-cols-3 gap-4"></div>
        </div>

        <!-- Quiz Type Selection -->
        <div id="quiz-type-section" class="mb-6 hidden">
            <h2 class="text-2xl font-semibold mb-4">Select Quiz Type</h2>
            <div id="quiz-type-list" class="grid grid-cols-1 sm:grid-cols-3 gap-4"></div>
            <button id="back-to-subjects" class="mt-4 px-4 py-2 bg-gray-500 text-white rounded hover:bg-gray-600">Back to Subjects</button>
        </div>

        <!-- Chapter Selection -->
        <div id="chapter-section" class="mb-6 hidden">
            <h2 class="text-2xl font-semibold mb-4">Select Chapter</h2>
            <div id="chapter-list" class="grid grid-cols-1 sm:grid-cols-3 gap-4"></div>
            <button id="back-to-quiz-types" class="mt-4 px-4 py-2 bg-gray-500 text-white rounded hover:bg-gray-600">Back to Quiz Types</button>
        </div>

        <!-- Unit Selection -->
        <div id="unit-section" class="mb-6 hidden">
            <h2 class="text-2xl font-semibold mb-4">Select Unit</h2>
            <div id="unit-list" class="grid grid-cols-1 sm:grid-cols-3 gap-4"></div>
            <button id="back-to-chapters" class="mt-4 px-4 py-2 bg-gray-500 text-white rounded hover:bg-gray-600">Back to Chapters</button>
        </div>

        <!-- Topic Selection -->
        <div id="topic-section" class="mb-6 hidden">
            <h2 class="text-2xl font-semibold mb-4">Select Topic</h2>
            <div id="topic-list" class="grid grid-cols-1 sm:grid-cols-3 gap-4"></div>
            <button id="back-to-units" class="mt-4 px-4 py-2 bg-gray-500 text-white rounded hover:bg-gray-600">Back to Units</button>
        </div>

        <!-- Quiz Game Section -->
        <div id="quiz-section" class="mb-6 hidden">
            <h2 class="text-2xl font-semibold mb-4">Quiz</h2>
            <div id="quiz-content" class="bg-white p-6 rounded-lg shadow-md">
                <div id="question-text" class="text-lg mb-4"></div>
                <div id="options-container" class="mb-4"></div>
                <div id="video-container" class="mb-4 hidden">
                    <iframe id="video-player" class="w-full h-64" frameborder="0" allowfullscreen></iframe>
                </div>
                <div id="flashcard-container" class="mb-4 hidden">
                    <p id="flashcard-text" class="text-lg"></p>
                </div>
                <div id="fillup-container" class="mb-4 hidden">
                    <input id="fillup-input" type="text" class="w-full p-2 border rounded" placeholder="Enter your answer">
                </div>
                <div id="match-container" class="mb-4 hidden">
                    <div id="match-options" class="grid grid-cols-2 gap-4"></div>
                </div>
                <div id="explanation" class="text-sm text-gray-600 mb-4 hidden"></div>
                <button id="submit-btn" class="px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600 hidden">Submit</button>
                <button id="next-btn" class="px-4 py-2 bg-green-500 text-white rounded hover:bg-green-600 hidden">Next Question</button>
            </div>
            <button id="back-to-topics" class="mt-4 px-4 py-2 bg-gray-500 text-white rounded hover:bg-gray-600">Back to Topics</button>
        </div>
    </div>

    <script>
        const subjects = [
            { name: 'Biology', url: 'https://itzfew.github.io/NEET-Questions/data/biology.json' },
            { name: 'Chemistry', url: 'https://itzfew.github.io/NEET-Questions/data/chemistry.json' },
            { name: 'Physics', url: 'https://itzfew.github.io/NEET-Questions/data/physics.json' }
        ];

        let currentSubjectData = [];
        let currentQuestions = [];
        let currentQuestionIndex = 0;
        let selectedQuizTypes = ['mcq', 'flashcard', 'fillup', 'match', 'video'];

        // DOM Elements
        const sections = {
            subject: document.getElementById('subject-section'),
            quizType: document.getElementById('quiz-type-section'),
            chapter: document.getElementById('chapter-section'),
            unit: document.getElementById('unit-section'),
            topic: document.getElementById('topic-section'),
            quiz: document.getElementById('quiz-section')
        };

        const lists = {
            subject: document.getElementById('subject-list'),
            quizType: document.getElementById('quiz-type-list'),
            chapter: document.getElementById('chapter-list'),
            unit: document.getElementById('unit-list'),
            topic: document.getElementById('topic-list')
        };

        const buttons = {
            backToSubjects: document.getElementById('back-to-subjects'),
            backToQuizTypes: document.getElementById('back-to-quiz-types'),
            backToChapters: document.getElementById('back-to-chapters'),
            backToUnits: document.getElementById('back-to-units'),
            backToTopics: document.getElementById('back-to-topics'),
            submit: document.getElementById('submit-btn'),
            next: document.getElementById('next-btn')
        };

        const quizContent = {
            question: document.getElementById('question-text'),
            options: document.getElementById('options-container'),
            video: document.getElementById('video-container'),
            videoPlayer: document.getElementById('video-player'),
            flashcard: document.getElementById('flashcard-container'),
            flashcardText: document.getElementById('flashcard-text'),
            fillup: document.getElementById('fillup-container'),
            fillupInput: document.getElementById('fillup-input'),
            match: document.getElementById('match-container'),
            matchOptions: document.getElementById('match-options'),
            explanation: document.getElementById('explanation')
        };

        // Initialize
        function init() {
            renderSubjectList();
            setupEventListeners();
        }

        // Render Subject List
        function renderSubjectList() {
            lists.subject.innerHTML = '';
            subjects.forEach(subject => {
                const btn = createButton(subject.name, () => loadSubjectData(subject.url, subject.name));
                lists.subject.appendChild(btn);
            });
        }

        // Load Subject Data
        async function loadSubjectData(url, subjectName) {
            try {
                const response = await fetch(url);
                currentSubjectData = await response.json();
                renderQuizTypeList();
                showSection('quizType');
            } catch (error) {
                alert('Error loading data. Please try again.');
                console.error(error);
            }
        }

        // Render Quiz Type List
        function renderQuizTypeList() {
            lists.quizType.innerHTML = '';
            const quizTypes = [...new Set(currentSubjectData.map(q => q.quiz_type))];
            quizTypes.forEach(type => {
                const div = document.createElement('div');
                div.className = 'flex items-center';
                const checkbox = document.createElement('input');
                checkbox.type = 'checkbox';
                checkbox.value = type;
                checkbox.checked = selectedQuizTypes.includes(type);
                checkbox.className = 'mr-2';
                checkbox.addEventListener('change', updateSelectedQuizTypes);
                const label = document.createElement('label');
                label.textContent = type.charAt(0).toUpperCase() + type.slice(1);
                div.appendChild(checkbox);
                div.appendChild(label);
                lists.quizType.appendChild(div);
            });
            updateChapterList();
        }

        // Update Selected Quiz Types
        function updateSelectedQuizTypes() {
            selectedQuizTypes = Array.from(document.querySelectorAll('#quiz-type-list input:checked')).map(cb => cb.value);
            updateChapterList();
        }

        // Update Chapter List
        function updateChapterList() {
            const chapters = [...new Set(currentSubjectData
                .filter(q => selectedQuizTypes.includes(q.quiz_type))
                .map(q => q['Chapter Name'] || q['chapter name'] || q['Unique Chapter Name'] || 'Unknown')
                .filter(ch => ch !== ''))];
            lists.chapter.innerHTML = '';
            chapters.sort().forEach(chapter => {
                const btn = createButton(chapter, () => selectChapter(chapter));
                lists.chapter.appendChild(btn);
            });
        }

        // Select Chapter
        function selectChapter(chapter) {
            renderUnitList(chapter);
            showSection('unit');
        }

        // Render Unit List
        function renderUnitList(chapter) {
            const units = [];
            currentSubjectData
                .filter(q => (q['Chapter Name'] || q['chapter name'] || q['Unique Chapter Name']) === chapter && selectedQuizTypes.includes(q.quiz_type))
                .forEach(q => {
                    const hierarchy = q.topic_name.split('>>').map(t => t.trim());
                    if (hierarchy.length > 1) {
                        units.push(hierarchy[1]);
                    }
                });
            const uniqueUnits = [...new Set(units)];
            lists.unit.innerHTML = '';
            uniqueUnits.sort().forEach(unitName => {
                const btn = createButton(unitName, () => selectUnit(chapter, unitName));
                lists.unit.appendChild(btn);
            });
        }

        // Select Unit
        function selectUnit(chapterName, unitName) {
            renderTopicList(chapterName, unitName);
            showSection('topic');
        }

        // Render Topic List
        function renderTopicList(chapterName, unitName) {
            const topics = [];
            currentSubjectData
                .filter(q => {
                    const hierarchy = q.topic_name.split('>>').map(t => t.trim());
                    return (
                        (q['Chapter Name'] || q['chapter name'] || q['Unique Chapter Name']) === chapterName &&
                        hierarchy[1] === unitName &&
                        selectedQuizTypes.includes(q.quiz_type)
                    );
                })
                .forEach(q => {
                    const hierarchy = q.topic_name.split('>>').map(t => t.trim());
                    if (hierarchy.length > 2) {
                        topics.push(hierarchy[2]);
                    }
                });
            const uniqueTopics = [...new Set(topics)];
            lists.topic.innerHTML = '';
            uniqueTopics.sort().forEach(topic => {
                const btn = createButton(topic, () => startQuiz(chapterName, unitName, topic));
                lists.topic.appendChild(btn);
            });
        }

        // Start Quiz
        function startQuiz(chapterName, unitName, topicName) {
            const topicPath = `${chapterName} >> ${unitName} >> ${topicName}`;
            currentQuestions = currentSubjectData.filter(q => q.topic_name === topicPath && selectedQuizTypes.includes(q.quiz_type));
            if (currentQuestions.length === 0) {
                alert('No questions available for this topic.');
                return;
            }
            currentQuestionIndex = 0;
            loadQuestion();
            showSection('quiz');
        }

        // Load Question
        function loadQuestion() {
            const q = currentQuestions[currentQuestionIndex];
            quizContent.question.innerHTML = q.question.replace(/\n/g, '<br>');
            quizContent.explanation.classList.add('hidden');
            quizContent.options.classList.add('hidden');
            quizContent.video.classList.add('hidden');
            quizContent.flashcard.classList.add('hidden');
            quizContent.fillup.classList.add('hidden');
            quizContent.match.classList.add('hidden');
            buttons.submit.classList.add('hidden');
            buttons.next.classList.add('hidden');

            switch (q.quiz_type) {
                case 'mcq':
                    renderMCQ(q);
                    break;
                case 'video':
                    renderVideo(q);
                    break;
                case 'flashcard':
                    renderFlashcard(q);
                    break;
                case 'fillup':
                    renderFillup(q);
                    break;
                case 'match':
                    renderMatch(q);
                    break;
            }
        }

        // Render MCQ
        function renderMCQ(q) {
            quizContent.options.innerHTML = '';
            const options = [
                { key: 'A', value: q.option_a },
                { key: 'B', value: q.option_b },
                { key: 'C', value: q.option_c },
                { key: 'D', value: q.option_d }
            ].filter(opt => opt.value !== '');
            options.forEach(opt => {
                const btn = document.createElement('button');
                btn.className = 'option-btn w-full text-left p-2 border rounded mb-2';
                btn.innerHTML = `<span>${opt.key}: ${opt.value}</span>`;
                btn.onclick = () => checkMCQAnswer(q, opt.value, btn);
                quizContent.options.appendChild(btn);
            });
            quizContent.options.classList.remove('hidden');
            buttons.submit.classList.add('hidden');
        }

        // Check MCQ Answer
        function checkMCQAnswer(q, selected, btn) {
            const correct = selected === q.answer;
            btn.classList.add(correct ? 'correct' : 'incorrect');
            quizContent.explanation.innerHTML = q.explanation || 'No explanation provided.';
            quizContent.explanation.classList.remove('hidden');
            buttons.next.classList.remove('hidden');
            quizContent.options.querySelectorAll('.option-btn').forEach(b => b.disabled = true);
        }

        // Render Video
        function renderVideo(q) {
            quizContent.videoPlayer.src = `https://www.youtube.com/embed/${q.question}`;
            quizContent.video.classList.remove('hidden');
            buttons.next.classList.remove('hidden');
        }

        // Render Flashcard
        function renderFlashcard(q) {
            quizContent.flashcardText.textContent = q.answer || q.question;
            quizContent.flashcard.classList.remove('hidden');
            buttons.next.classList.remove('hidden');
        }

        // Render Fillup
        function renderFillup(q) {
            quizContent.fillupInput.value = '';
            quizContent.fillup.classList.remove('hidden');
            buttons.submit.classList.remove('hidden');
            buttons.submit.onclick = () => checkFillupAnswer(q);
        }

        // Check Fillup Answer
        function checkFillupAnswer(q) {
            const selected = quizContent.fillupInput.value.trim();
            const correct = selected.toLowerCase() === q.answer.toLowerCase();
            quizContent.fillupInput.classList.add(correct ? 'correct' : 'incorrect');
            quizContent.explanation.innerHTML = q.explanation || 'No explanation provided.';
            quizContent.explanation.classList.remove('hidden');
            buttons.next.classList.remove('hidden');
            buttons.submit.classList.add('hidden');
        }

        // Render Match
        function renderMatch(q) {
            quizContent.matchOptions.innerHTML = '';
            const pairs = q.answer.split(',').map(p => p.split('='));
            const options = [
                { key: 'A', value: q.option_a.split(',')[1] },
                { key: 'B', value: q.option_b.split(',')[1] }
            ].filter(opt => opt.value);
            options.forEach(opt => {
                const div = document.createElement('div');
                div.innerHTML = `<p>${opt.key}: ${opt.value}</p>`;
                quizContent.matchOptions.appendChild(div);
            });
            quizContent.match.classList.remove('hidden');
            buttons.submit.classList.remove('hidden');
            buttons.submit.onclick = () => checkMatchAnswer(q);
        }

        // Check Match Answer
        function checkMatchAnswer(q) {
            quizContent.explanation.innerHTML = q.explanation || 'No explanation provided.';
            quizContent.explanation.classList.remove('hidden');
            buttons.next.classList.remove('hidden');
            buttons.submit.classList.add('hidden');
        }

        // Create Button
        function createButton(text, onClick) {
            const btn = document.createElement('button');
            btn.className = 'px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600';
            btn.textContent = text;
            btn.onclick = onClick;
            return btn;
        }

        // Show Section
        function showSection(sectionName) {
            Object.values(sections).forEach(s => s.classList.add('hidden'));
            sections[sectionName].classList.remove('hidden');
        }

        // Setup Event Listeners
        function setupEventListeners() {
            buttons.backToSubjects.onclick = () => showSection('subject');
            buttons.backToQuizTypes.onclick = () => showSection('quizType');
            buttons.backToChapters.onclick = () => showSection('chapter');
            buttons.backToUnits.onclick = () => showSection('unit');
            buttons.backToTopics.onclick = () => showSection('topic');
            buttons.next.onclick = () => {
                currentQuestionIndex++;
                if (currentQuestionIndex < currentQuestions.length) {
                    loadQuestion();
                } else {
                    alert('Quiz completed!');
                    showSection('topic');
                }
            };
        }

        // Start the application
        init();
    </script>
</body>
</html>
